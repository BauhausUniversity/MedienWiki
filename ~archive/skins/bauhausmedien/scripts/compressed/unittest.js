Event.simulateMouse=function(_1,_2){var _3=Object.extend({pointerX:0,pointerY:0,buttons:0,ctrlKey:false,altKey:false,shiftKey:false,metaKey:false},arguments[2]||{});var _4=document.createEvent("MouseEvents");_4.initMouseEvent(_2,true,true,document.defaultView,_3.buttons,_3.pointerX,_3.pointerY,_3.pointerX,_3.pointerY,_3.ctrlKey,_3.altKey,_3.shiftKey,_3.metaKey,0,$(_1));if(this.mark){Element.remove(this.mark);}this.mark=document.createElement("div");this.mark.appendChild(document.createTextNode(" "));document.body.appendChild(this.mark);this.mark.style.position="absolute";this.mark.style.top=_3.pointerY+"px";this.mark.style.left=_3.pointerX+"px";this.mark.style.width="5px";this.mark.style.height="5px;";this.mark.style.borderTop="1px solid red;";this.mark.style.borderLeft="1px solid red;";if(this.step){alert("["+new Date().getTime().toString()+"] "+_2+"/"+Test.Unit.inspect(_3));}$(_1).dispatchEvent(_4);};Event.simulateKey=function(_5,_6){var _7=Object.extend({ctrlKey:false,altKey:false,shiftKey:false,metaKey:false,keyCode:0,charCode:0},arguments[2]||{});var _8=document.createEvent("KeyEvents");_8.initKeyEvent(_6,true,true,window,_7.ctrlKey,_7.altKey,_7.shiftKey,_7.metaKey,_7.keyCode,_7.charCode);$(_5).dispatchEvent(_8);};Event.simulateKeys=function(_9,_a){for(var i=0;i<_a.length;i++){Event.simulateKey(_9,"keypress",{charCode:_a.charCodeAt(i)});}};var Test={};Test.Unit={};Test.Unit.inspect=Object.inspect;Test.Unit.Logger=Class.create();Test.Unit.Logger.prototype={initialize:function(_b){this.log=$(_b);if(this.log){this._createLogTable();}},start:function(_c){if(!this.log){return;}this.testName=_c;this.lastLogLine=document.createElement("tr");this.statusCell=document.createElement("td");this.nameCell=document.createElement("td");this.nameCell.className="nameCell";this.nameCell.appendChild(document.createTextNode(_c));this.messageCell=document.createElement("td");this.lastLogLine.appendChild(this.statusCell);this.lastLogLine.appendChild(this.nameCell);this.lastLogLine.appendChild(this.messageCell);this.loglines.appendChild(this.lastLogLine);},finish:function(_d,_e){if(!this.log){return;}this.lastLogLine.className=_d;this.statusCell.innerHTML=_d;this.messageCell.innerHTML=this._toHTML(_e);this.addLinksToResults();},message:function(_f){if(!this.log){return;}this.messageCell.innerHTML=this._toHTML(_f);},summary:function(_10){if(!this.log){return;}this.logsummary.innerHTML=this._toHTML(_10);},_createLogTable:function(){this.log.innerHTML="<div id=\"logsummary\"></div>"+"<table id=\"logtable\">"+"<thead><tr><th>Status</th><th>Test</th><th>Message</th></tr></thead>"+"<tbody id=\"loglines\"></tbody>"+"</table>";this.logsummary=$("logsummary");this.loglines=$("loglines");},_toHTML:function(txt){return txt.escapeHTML().replace(/\n/g,"<br/>");},addLinksToResults:function(){$$("tr.failed .nameCell").each(function(td){td.title="Run only this test";Event.observe(td,"click",function(){window.location.search="?tests="+td.innerHTML;});});$$("tr.passed .nameCell").each(function(td){td.title="Run all tests";Event.observe(td,"click",function(){window.location.search="";});});}};Test.Unit.Runner=Class.create();Test.Unit.Runner.prototype={initialize:function(_11){this.options=Object.extend({testLog:"testlog"},arguments[1]||{});this.options.resultsURL=this.parseResultsURLQueryParameter();this.options.tests=this.parseTestsQueryParameter();if(this.options.testLog){this.options.testLog=$(this.options.testLog)||null;}if(this.options.tests){this.tests=[];for(var i=0;i<this.options.tests.length;i++){if(/^test/.test(this.options.tests[i])){this.tests.push(new Test.Unit.Testcase(this.options.tests[i],_11[this.options.tests[i]],_11["setup"],_11["teardown"]));}}}else{if(this.options.test){this.tests=[new Test.Unit.Testcase(this.options.test,_11[this.options.test],_11["setup"],_11["teardown"])];}else{this.tests=[];for(var _12 in _11){if(/^test/.test(_12)){this.tests.push(new Test.Unit.Testcase(this.options.context?" -> "+this.options.titles[_12]:_12,_11[_12],_11["setup"],_11["teardown"]));}}}}this.currentTest=0;this.logger=new Test.Unit.Logger(this.options.testLog);setTimeout(this.runTests.bind(this),1000);},parseResultsURLQueryParameter:function(){return window.location.search.parseQuery()["resultsURL"];},parseTestsQueryParameter:function(){if(window.location.search.parseQuery()["tests"]){return window.location.search.parseQuery()["tests"].split(",");}},getResult:function(){var _13=false;for(var i=0;i<this.tests.length;i++){if(this.tests[i].errors>0){return "ERROR";}if(this.tests[i].failures>0){_13=true;}}if(_13){return "FAILURE";}else{return "SUCCESS";}},postResults:function(){if(this.options.resultsURL){new Ajax.Request(this.options.resultsURL,{method:"get",parameters:"result="+this.getResult(),asynchronous:false});}},runTests:function(){var _14=this.tests[this.currentTest];if(!_14){this.postResults();this.logger.summary(this.summary());return;}if(!_14.isWaiting){this.logger.start(_14.name);}_14.run();if(_14.isWaiting){this.logger.message("Waiting for "+_14.timeToWait+"ms");setTimeout(this.runTests.bind(this),_14.timeToWait||1000);}else{this.logger.finish(_14.status(),_14.summary());this.currentTest++;this.runTests();}},summary:function(){var _15=0;var _16=0;var _17=0;var _18=[];for(var i=0;i<this.tests.length;i++){_15+=this.tests[i].assertions;_16+=this.tests[i].failures;_17+=this.tests[i].errors;}return ((this.options.context?this.options.context+": ":"")+this.tests.length+" tests, "+_15+" assertions, "+_16+" failures, "+_17+" errors");}};Test.Unit.Assertions=Class.create();Test.Unit.Assertions.prototype={initialize:function(){this.assertions=0;this.failures=0;this.errors=0;this.messages=[];},summary:function(){return (this.assertions+" assertions, "+this.failures+" failures, "+this.errors+" errors"+"\n"+this.messages.join("\n"));},pass:function(){this.assertions++;},fail:function(_19){this.failures++;this.messages.push("Failure: "+_19);},info:function(_1a){this.messages.push("Info: "+_1a);},error:function(_1b){this.errors++;this.messages.push(_1b.name+": "+_1b.message+"("+Test.Unit.inspect(_1b)+")");},status:function(){if(this.failures>0){return "failed";}if(this.errors>0){return "error";}return "passed";},assert:function(_1c){var _1d=arguments[1]||"assert: got \""+Test.Unit.inspect(_1c)+"\"";try{_1c?this.pass():this.fail(_1d);}catch(e){this.error(e);}},assertEqual:function(_1e,_1f){var _20=arguments[2]||"assertEqual";try{(_1e==_1f)?this.pass():this.fail(_20+": expected \""+Test.Unit.inspect(_1e)+"\", actual \""+Test.Unit.inspect(_1f)+"\"");}catch(e){this.error(e);}},assertInspect:function(_21,_22){var _23=arguments[2]||"assertInspect";try{(_21==_22.inspect())?this.pass():this.fail(_23+": expected \""+Test.Unit.inspect(_21)+"\", actual \""+Test.Unit.inspect(_22)+"\"");}catch(e){this.error(e);}},assertEnumEqual:function(_24,_25){var _26=arguments[2]||"assertEnumEqual";try{$A(_24).length==$A(_25).length&&_24.zip(_25).all(function(_27){return _27[0]==_27[1];})?this.pass():this.fail(_26+": expected "+Test.Unit.inspect(_24)+", actual "+Test.Unit.inspect(_25));}catch(e){this.error(e);}},assertNotEqual:function(_28,_29){var _2a=arguments[2]||"assertNotEqual";try{(_28!=_29)?this.pass():this.fail(_2a+": got \""+Test.Unit.inspect(_29)+"\"");}catch(e){this.error(e);}},assertIdentical:function(_2b,_2c){var _2d=arguments[2]||"assertIdentical";try{(_2b===_2c)?this.pass():this.fail(_2d+": expected \""+Test.Unit.inspect(_2b)+"\", actual \""+Test.Unit.inspect(_2c)+"\"");}catch(e){this.error(e);}},assertNotIdentical:function(_2e,_2f){var _30=arguments[2]||"assertNotIdentical";try{!(_2e===_2f)?this.pass():this.fail(_30+": expected \""+Test.Unit.inspect(_2e)+"\", actual \""+Test.Unit.inspect(_2f)+"\"");}catch(e){this.error(e);}},assertNull:function(obj){var _31=arguments[1]||"assertNull";try{(obj==null)?this.pass():this.fail(_31+": got \""+Test.Unit.inspect(obj)+"\"");}catch(e){this.error(e);}},assertMatch:function(_32,_33){var _34=arguments[2]||"assertMatch";var _35=new RegExp(_32);try{(_35.exec(_33))?this.pass():this.fail(_34+" : regex: \""+Test.Unit.inspect(_32)+" did not match: "+Test.Unit.inspect(_33)+"\"");}catch(e){this.error(e);}},assertHidden:function(_36){var _37=arguments[1]||"assertHidden";this.assertEqual("none",_36.style.display,_37);},assertNotNull:function(_38){var _39=arguments[1]||"assertNotNull";this.assert(_38!=null,_39);},assertType:function(_3a,_3b){var _3c=arguments[2]||"assertType";try{(_3b.constructor==_3a)?this.pass():this.fail(_3c+": expected \""+Test.Unit.inspect(_3a)+"\", actual \""+(_3b.constructor)+"\"");}catch(e){this.error(e);}},assertNotOfType:function(_3d,_3e){var _3f=arguments[2]||"assertNotOfType";try{(_3e.constructor!=_3d)?this.pass():this.fail(_3f+": expected \""+Test.Unit.inspect(_3d)+"\", actual \""+(_3e.constructor)+"\"");}catch(e){this.error(e);}},assertInstanceOf:function(_40,_41){var _42=arguments[2]||"assertInstanceOf";try{(_41 instanceof _40)?this.pass():this.fail(_42+": object was not an instance of the expected type");}catch(e){this.error(e);}},assertNotInstanceOf:function(_43,_44){var _45=arguments[2]||"assertNotInstanceOf";try{!(_44 instanceof _43)?this.pass():this.fail(_45+": object was an instance of the not expected type");}catch(e){this.error(e);}},assertRespondsTo:function(_46,obj){var _47=arguments[2]||"assertRespondsTo";try{(obj[_46]&&typeof obj[_46]=="function")?this.pass():this.fail(_47+": object doesn't respond to ["+_46+"]");}catch(e){this.error(e);}},assertReturnsTrue:function(_48,obj){var _49=arguments[2]||"assertReturnsTrue";try{var m=obj[_48];if(!m){m=obj["is"+_48.charAt(0).toUpperCase()+_48.slice(1)];}m()?this.pass():this.fail(_49+": method returned false");}catch(e){this.error(e);}},assertReturnsFalse:function(_4a,obj){var _4b=arguments[2]||"assertReturnsFalse";try{var m=obj[_4a];if(!m){m=obj["is"+_4a.charAt(0).toUpperCase()+_4a.slice(1)];}!m()?this.pass():this.fail(_4b+": method returned true");}catch(e){this.error(e);}},assertRaise:function(_4c,_4d){var _4e=arguments[2]||"assertRaise";try{_4d();this.fail(_4e+": exception expected but none was raised");}catch(e){((_4c==null)||(e.name==_4c))?this.pass():this.error(e);}},assertElementsMatch:function(){var _4f=$A(arguments),_50=$A(_4f.shift());if(_50.length!=_4f.length){this.fail("assertElementsMatch: size mismatch: "+_50.length+" elements, "+_4f.length+" expressions");return false;}_50.zip(_4f).all(function(_51,_52){var _53=$(_51.first()),_54=_51.last();if(_53.match(_54)){return true;}this.fail("assertElementsMatch: (in index "+_52+") expected "+_54.inspect()+" but got "+_53.inspect());}.bind(this))&&this.pass();},assertElementMatches:function(_55,_56){this.assertElementsMatch([_55],_56);},benchmark:function(_57,_58){var _59=new Date();(_58||1).times(_57);var _5a=((new Date())-_59);this.info((arguments[2]||"Operation")+" finished "+_58+" iterations in "+(_5a/1000)+"s");return _5a;},_isVisible:function(_5b){_5b=$(_5b);if(!_5b.parentNode){return true;}this.assertNotNull(_5b);if(_5b.style&&Element.getStyle(_5b,"display")=="none"){return false;}return this._isVisible(_5b.parentNode);},assertNotVisible:function(_5c){this.assert(!this._isVisible(_5c),Test.Unit.inspect(_5c)+" was not hidden and didn't have a hidden parent either. "+(""||arguments[1]));},assertVisible:function(_5d){this.assert(this._isVisible(_5d),Test.Unit.inspect(_5d)+" was not visible. "+(""||arguments[1]));},benchmark:function(_5e,_5f){var _60=new Date();(_5f||1).times(_5e);var _61=((new Date())-_60);this.info((arguments[2]||"Operation")+" finished "+_5f+" iterations in "+(_61/1000)+"s");return _61;}};Test.Unit.Testcase=Class.create();Object.extend(Object.extend(Test.Unit.Testcase.prototype,Test.Unit.Assertions.prototype),{initialize:function(_62,_63,_64,_65){Test.Unit.Assertions.prototype.initialize.bind(this)();this.name=_62;if(typeof _63=="string"){_63=_63.gsub(/(\.should[^\(]+\()/,"#{0}this,");_63=_63.gsub(/(\.should[^\(]+)\(this,\)/,"#{1}(this)");this.test=function(){eval("with(this){"+_63+"}");};}else{this.test=_63||function(){};}this.setup=_64||function(){};this.teardown=_65||function(){};this.isWaiting=false;this.timeToWait=1000;},wait:function(_66,_67){this.isWaiting=true;this.test=_67;this.timeToWait=_66;},run:function(){try{try{if(!this.isWaiting){this.setup.bind(this)();}this.isWaiting=false;this.test.bind(this)();}finally{if(!this.isWaiting){this.teardown.bind(this)();}}}catch(e){this.error(e);}}});Test.setupBDDExtensionMethods=function(){var _68={shouldEqual:"assertEqual",shouldNotEqual:"assertNotEqual",shouldEqualEnum:"assertEnumEqual",shouldBeA:"assertType",shouldNotBeA:"assertNotOfType",shouldBeAn:"assertType",shouldNotBeAn:"assertNotOfType",shouldBeNull:"assertNull",shouldNotBeNull:"assertNotNull",shouldBe:"assertReturnsTrue",shouldNotBe:"assertReturnsFalse",shouldRespondTo:"assertRespondsTo"};var _69=function(_6a,_6b,_6c){this[_6a].apply(this,(_6b||[]).concat([_6c]));};Test.BDDMethods={};$H(_68).each(function(_6d){Test.BDDMethods[_6d.key]=function(){var _6e=$A(arguments);var _6f=_6e.shift();_69.apply(_6f,[_6d.value,_6e,this]);};});[Array.prototype,String.prototype,Number.prototype,Boolean.prototype].each(function(p){Object.extend(p,Test.BDDMethods);});};Test.context=function(_70,_71,log){Test.setupBDDExtensionMethods();var _72={};var _73={};for(specName in _71){switch(specName){case "setup":case "teardown":_72[specName]=_71[specName];break;default:var _74="test"+specName.gsub(/\s+/,"-").camelize();var _75=_71[specName].toString().split("\n").slice(1);if(/^\{/.test(_75[0])){_75=_75.slice(1);}_75.pop();_75=_75.map(function(_76){return _76.strip();});_72[_74]=_75.join("\n");_73[_74]=specName;}}new Test.Unit.Runner(_72,{titles:_73,testLog:log||"testlog",context:_70});};