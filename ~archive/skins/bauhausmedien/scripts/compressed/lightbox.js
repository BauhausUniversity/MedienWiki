LightboxOptions=Object.extend({fileLoadingImage:"extensions/lightbox/images/loading.gif",fileBottomNavCloseImage:"extensions/lightbox/images/closelabel.gif",overlayOpacity:0.8,animate:true,resizeSpeed:7,borderSize:10,labelImage:"Image",labelOf:"of"},window.LightboxOptions||{});var Lightbox=Class.create();Lightbox.prototype={imageArray:[],activeImage:undefined,initialize:function(){this.updateImageList();this.keyboardAction=this.keyboardAction.bindAsEventListener(this);if(LightboxOptions.resizeSpeed>10){LightboxOptions.resizeSpeed=10;}if(LightboxOptions.resizeSpeed<1){LightboxOptions.resizeSpeed=1;}this.resizeDuration=LightboxOptions.animate?((11-LightboxOptions.resizeSpeed)*0.15):0;this.overlayDuration=LightboxOptions.animate?0.2:0;var _1=(LightboxOptions.animate?250:1)+"px";var _2=$$("body")[0];_2.appendChild(Builder.node("div",{id:"overlay"}));_2.appendChild(Builder.node("div",{id:"lightbox"},[Builder.node("div",{id:"outerImageContainer"},Builder.node("div",{id:"imageContainer"},[Builder.node("img",{id:"lightboxImage"}),Builder.node("div",{id:"hoverNav"},[Builder.node("a",{id:"prevLink",href:"#"}),Builder.node("a",{id:"nextLink",href:"#"})]),Builder.node("div",{id:"loading"},Builder.node("a",{id:"loadingLink",href:"#"},Builder.node("img",{src:LightboxOptions.fileLoadingImage})))])),Builder.node("div",{id:"imageDataContainer"},Builder.node("div",{id:"imageData"},[Builder.node("div",{id:"imageDetails"},[Builder.node("span",{id:"caption"}),Builder.node("span",{id:"numberDisplay"})]),Builder.node("div",{id:"bottomNav"},Builder.node("a",{id:"bottomNavClose",href:"#"},Builder.node("img",{src:LightboxOptions.fileBottomNavCloseImage})))]))]));$("overlay").hide().observe("click",(function(){this.end();}).bind(this));$("lightbox").hide().observe("click",(function(_3){if(_3.element().id=="lightbox"){this.end();}}).bind(this));$("outerImageContainer").setStyle({width:_1,height:_1});$("prevLink").observe("click",(function(_4){_4.stop();this.changeImage(this.activeImage-1);}).bindAsEventListener(this));$("nextLink").observe("click",(function(_5){_5.stop();this.changeImage(this.activeImage+1);}).bindAsEventListener(this));$("loadingLink").observe("click",(function(_6){_6.stop();this.end();}).bind(this));$("bottomNavClose").observe("click",(function(_7){_7.stop();this.end();}).bind(this));var th=this;(function(){var _8="overlay lightbox outerImageContainer imageContainer lightboxImage hoverNav prevLink nextLink loading loadingLink "+"imageDataContainer imageData imageDetails caption numberDisplay bottomNav bottomNavClose";$w(_8).each(function(id){th[id]=$(id);});}).defer();},updateImageList:function(){this.updateImageList=Prototype.emptyFunction;document.observe("click",(function(_9){var _a=_9.findElement("a[rel^=lightbox]")||_9.findElement("area[rel^=lightbox]");if(_a){_9.stop();this.start(_a);}}).bind(this));},start:function(_b){$$("select","object","embed").each(function(_c){_c.style.visibility="hidden";});var _d=this.getPageSize();$("overlay").setStyle({width:_d[0]+"px",height:_d[1]+"px"});new Effect.Appear(this.overlay,{duration:this.overlayDuration,from:0,to:LightboxOptions.overlayOpacity});this.imageArray=[];var _e=0;if((_b.rel=="lightbox")){this.imageArray.push([_b.href,_b.title]);}else{this.imageArray=$$(_b.tagName+"[href][rel=\""+_b.rel+"\"]").collect(function(_f){return [_f.href,_f.title];}).uniq();while(this.imageArray[_e][0]!=_b.href){_e++;}}var _10=document.viewport.getScrollOffsets();var _11=_10[1]+(document.viewport.getHeight()/10);var _12=_10[0];this.lightbox.setStyle({top:_11+"px",left:_12+"px"}).show();this.changeImage(_e);},changeImage:function(_13){this.activeImage=_13;if(LightboxOptions.animate){this.loading.show();}this.lightboxImage.hide();this.hoverNav.hide();this.prevLink.hide();this.nextLink.hide();this.imageDataContainer.setStyle({opacity:0.0001});this.numberDisplay.hide();var _14=new Image();_14.onload=(function(){this.lightboxImage.src=this.imageArray[this.activeImage][0];this.resizeImageContainer(_14.width,_14.height);}).bind(this);_14.src=this.imageArray[this.activeImage][0];},resizeImageContainer:function(_15,_16){var _17=this.outerImageContainer.getWidth();var _18=this.outerImageContainer.getHeight();if(_15>1024){var _19=_15/_16;_15=1024;_16=_15/_19;}var _1a=(_15+LightboxOptions.borderSize*2);var _1b=(_16+LightboxOptions.borderSize*2);var _1c=(_1a/_17)*100;var _1d=(_1b/_18)*100;var _1e=_17-_1a;var _1f=_18-_1b;if(_1f!=0){new Effect.Scale(this.outerImageContainer,_1d,{scaleX:false,duration:this.resizeDuration,queue:"front"});}if(_1e!=0){new Effect.Scale(this.outerImageContainer,_1c,{scaleY:false,duration:this.resizeDuration,delay:this.resizeDuration});}var _20=0;if((_1f==0)&&(_1e==0)){_20=100;if(Prototype.Browser.IE){_20=250;}}(function(){this.prevLink.setStyle({height:_16+"px"});this.nextLink.setStyle({height:_16+"px"});this.imageDataContainer.setStyle({width:_1a+"px"});this.showImage();}).bind(this).delay(_20/1000);},showImage:function(){this.loading.hide();new Effect.Appear(this.lightboxImage,{duration:this.resizeDuration,queue:"end",afterFinish:(function(){this.updateDetails();}).bind(this)});this.preloadNeighborImages();},updateDetails:function(){if(this.imageArray[this.activeImage][1]!=""){this.caption.update(this.imageArray[this.activeImage][1]).show();}if(this.imageArray.length>1){this.numberDisplay.update(LightboxOptions.labelImage+" "+(this.activeImage+1)+" "+LightboxOptions.labelOf+"  "+this.imageArray.length).show();}new Effect.Parallel([new Effect.SlideDown(this.imageDataContainer,{sync:true,duration:this.resizeDuration,from:0,to:1}),new Effect.Appear(this.imageDataContainer,{sync:true,duration:this.resizeDuration})],{duration:this.resizeDuration,afterFinish:(function(){var _21=this.getPageSize();this.overlay.setStyle({height:_21[1]+"px"});this.updateNav();}).bind(this)});},updateNav:function(){this.hoverNav.show();if(this.activeImage>0){this.prevLink.show();}if(this.activeImage<(this.imageArray.length-1)){this.nextLink.show();}this.enableKeyboardNav();},enableKeyboardNav:function(){document.observe("keydown",this.keyboardAction);},disableKeyboardNav:function(){document.stopObserving("keydown",this.keyboardAction);},keyboardAction:function(_22){var _23=_22.keyCode;var _24;if(_22.DOM_VK_ESCAPE){_24=_22.DOM_VK_ESCAPE;}else{_24=27;}var key=String.fromCharCode(_23).toLowerCase();if(key.match(/x|o|c/)||(_23==_24)){this.end();}else{if((key=="p")||(_23==37)){if(this.activeImage!=0){this.disableKeyboardNav();this.changeImage(this.activeImage-1);}}else{if((key=="n")||(_23==39)){if(this.activeImage!=(this.imageArray.length-1)){this.disableKeyboardNav();this.changeImage(this.activeImage+1);}}}}},preloadNeighborImages:function(){var _25,_26;if(this.imageArray.length>this.activeImage+1){_25=new Image();_25.src=this.imageArray[this.activeImage+1][0];}if(this.activeImage>0){_26=new Image();_26.src=this.imageArray[this.activeImage-1][0];}},end:function(){this.disableKeyboardNav();this.lightbox.hide();new Effect.Fade(this.overlay,{duration:this.overlayDuration});$$("select","object","embed").each(function(_27){_27.style.visibility="visible";});},getPageSize:function(){var _28,_29;if(window.innerHeight&&window.scrollMaxY){_28=window.innerWidth+window.scrollMaxX;_29=window.innerHeight+window.scrollMaxY;}else{if(document.body.scrollHeight>document.body.offsetHeight){_28=document.body.scrollWidth;_29=document.body.scrollHeight;}else{_28=document.body.offsetWidth;_29=document.body.offsetHeight;}}var _2a,_2b;if(self.innerHeight){if(document.documentElement.clientWidth){_2a=document.documentElement.clientWidth;}else{_2a=self.innerWidth;}_2b=self.innerHeight;}else{if(document.documentElement&&document.documentElement.clientHeight){_2a=document.documentElement.clientWidth;_2b=document.documentElement.clientHeight;}else{if(document.body){_2a=document.body.clientWidth;_2b=document.body.clientHeight;}}}if(_29<_2b){pageHeight=_2b;}else{pageHeight=_29;}if(_28<_2a){pageWidth=_28;}else{pageWidth=_2a;}return [pageWidth,pageHeight];}};document.observe("dom:loaded",function(){new Lightbox();});