if(Object.isUndefined(Effect)){throw ("dragdrop.js requires including script.aculo.us' effects.js library");}var Droppables={drops:[],remove:function(_1){this.drops=this.drops.reject(function(d){return d.element==$(_1);});},add:function(_2){_2=$(_2);var _3=Object.extend({greedy:true,hoverclass:null,tree:false},arguments[1]||{});if(_3.containment){_3._containers=[];var _4=_3.containment;if(Object.isArray(_4)){_4.each(function(c){_3._containers.push($(c));});}else{_3._containers.push($(_4));}}if(_3.accept){_3.accept=[_3.accept].flatten();}Element.makePositioned(_2);_3.element=_2;this.drops.push(_3);},findDeepestChild:function(_5){deepest=_5[0];for(i=1;i<_5.length;++i){if(Element.isParent(_5[i].element,deepest.element)){deepest=_5[i];}}return deepest;},isContained:function(_6,_7){var _8;if(_7.tree){_8=_6.treeNode;}else{_8=_6.parentNode;}return _7._containers.detect(function(c){return _8==c;});},isAffected:function(_9,_a,_b){return ((_b.element!=_a)&&((!_b._containers)||this.isContained(_a,_b))&&((!_b.accept)||(Element.classNames(_a).detect(function(v){return _b.accept.include(v);})))&&Position.within(_b.element,_9[0],_9[1]));},deactivate:function(_c){if(_c.hoverclass){Element.removeClassName(_c.element,_c.hoverclass);}this.last_active=null;},activate:function(_d){if(_d.hoverclass){Element.addClassName(_d.element,_d.hoverclass);}this.last_active=_d;},show:function(_e,_f){if(!this.drops.length){return;}var _10,_11=[];this.drops.each(function(_12){if(Droppables.isAffected(_e,_f,_12)){_11.push(_12);}});if(_11.length>0){_10=Droppables.findDeepestChild(_11);}if(this.last_active&&this.last_active!=_10){this.deactivate(this.last_active);}if(_10){Position.within(_10.element,_e[0],_e[1]);if(_10.onHover){_10.onHover(_f,_10.element,Position.overlap(_10.overlap,_10.element));}if(_10!=this.last_active){Droppables.activate(_10);}}},fire:function(_13,_14){if(!this.last_active){return;}Position.prepare();if(this.isAffected([Event.pointerX(_13),Event.pointerY(_13)],_14,this.last_active)){if(this.last_active.onDrop){this.last_active.onDrop(_14,this.last_active.element,_13);return true;}}},reset:function(){if(this.last_active){this.deactivate(this.last_active);}}};var Draggables={drags:[],observers:[],register:function(_15){if(this.drags.length==0){this.eventMouseUp=this.endDrag.bindAsEventListener(this);this.eventMouseMove=this.updateDrag.bindAsEventListener(this);this.eventKeypress=this.keyPress.bindAsEventListener(this);Event.observe(document,"mouseup",this.eventMouseUp);Event.observe(document,"mousemove",this.eventMouseMove);Event.observe(document,"keypress",this.eventKeypress);}this.drags.push(_15);},unregister:function(_16){this.drags=this.drags.reject(function(d){return d==_16;});if(this.drags.length==0){Event.stopObserving(document,"mouseup",this.eventMouseUp);Event.stopObserving(document,"mousemove",this.eventMouseMove);Event.stopObserving(document,"keypress",this.eventKeypress);}},activate:function(_17){if(_17.options.delay){this._timeout=setTimeout(function(){Draggables._timeout=null;window.focus();Draggables.activeDraggable=_17;}.bind(this),_17.options.delay);}else{window.focus();this.activeDraggable=_17;}},deactivate:function(){this.activeDraggable=null;},updateDrag:function(_18){if(!this.activeDraggable){return;}var _19=[Event.pointerX(_18),Event.pointerY(_18)];if(this._lastPointer&&(this._lastPointer.inspect()==_19.inspect())){return;}this._lastPointer=_19;this.activeDraggable.updateDrag(_18,_19);},endDrag:function(_1a){if(this._timeout){clearTimeout(this._timeout);this._timeout=null;}if(!this.activeDraggable){return;}this._lastPointer=null;this.activeDraggable.endDrag(_1a);this.activeDraggable=null;},keyPress:function(_1b){if(this.activeDraggable){this.activeDraggable.keyPress(_1b);}},addObserver:function(_1c){this.observers.push(_1c);this._cacheObserverCallbacks();},removeObserver:function(_1d){this.observers=this.observers.reject(function(o){return o.element==_1d;});this._cacheObserverCallbacks();},notify:function(_1e,_1f,_20){if(this[_1e+"Count"]>0){this.observers.each(function(o){if(o[_1e]){o[_1e](_1e,_1f,_20);}});}if(_1f.options[_1e]){_1f.options[_1e](_1f,_20);}},_cacheObserverCallbacks:function(){["onStart","onEnd","onDrag"].each(function(_21){Draggables[_21+"Count"]=Draggables.observers.select(function(o){return o[_21];}).length;});}};var Draggable=Class.create({initialize:function(_22){var _23={handle:false,reverteffect:function(_24,_25,_26){var dur=Math.sqrt(Math.abs(_25^2)+Math.abs(_26^2))*0.02;new Effect.Move(_24,{x:-_26,y:-_25,duration:dur,queue:{scope:"_draggable",position:"end"}});},endeffect:function(_27){var _28=Object.isNumber(_27._opacity)?_27._opacity:1;new Effect.Opacity(_27,{duration:0.2,from:0.7,to:_28,queue:{scope:"_draggable",position:"end"},afterFinish:function(){Draggable._dragging[_27]=false;}});},zindex:1000,revert:false,quiet:false,scroll:false,scrollSensitivity:20,scrollSpeed:15,snap:false,delay:0};if(!arguments[1]||Object.isUndefined(arguments[1].endeffect)){Object.extend(_23,{starteffect:function(_29){_29._opacity=Element.getOpacity(_29);Draggable._dragging[_29]=true;new Effect.Opacity(_29,{duration:0.2,from:_29._opacity,to:0.7});}});}var _2a=Object.extend(_23,arguments[1]||{});this.element=$(_22);if(_2a.handle&&Object.isString(_2a.handle)){this.handle=this.element.down("."+_2a.handle,0);}if(!this.handle){this.handle=$(_2a.handle);}if(!this.handle){this.handle=this.element;}if(_2a.scroll&&!_2a.scroll.scrollTo&&!_2a.scroll.outerHTML){_2a.scroll=$(_2a.scroll);this._isScrollChild=Element.childOf(this.element,_2a.scroll);}Element.makePositioned(this.element);this.options=_2a;this.dragging=false;this.eventMouseDown=this.initDrag.bindAsEventListener(this);Event.observe(this.handle,"mousedown",this.eventMouseDown);Draggables.register(this);},destroy:function(){Event.stopObserving(this.handle,"mousedown",this.eventMouseDown);Draggables.unregister(this);},currentDelta:function(){return ([parseInt(Element.getStyle(this.element,"left")||"0"),parseInt(Element.getStyle(this.element,"top")||"0")]);},initDrag:function(_2b){if(!Object.isUndefined(Draggable._dragging[this.element])&&Draggable._dragging[this.element]){return;}if(Event.isLeftClick(_2b)){var src=Event.element(_2b);if((tag_name=src.tagName.toUpperCase())&&(tag_name=="INPUT"||tag_name=="SELECT"||tag_name=="OPTION"||tag_name=="BUTTON"||tag_name=="TEXTAREA")){return;}var _2c=[Event.pointerX(_2b),Event.pointerY(_2b)];var pos=this.element.cumulativeOffset();this.offset=[0,1].map(function(i){return (_2c[i]-pos[i]);});Draggables.activate(this);Event.stop(_2b);}},startDrag:function(_2d){this.dragging=true;if(!this.delta){this.delta=this.currentDelta();}if(this.options.zindex){this.originalZ=parseInt(Element.getStyle(this.element,"z-index")||0);this.element.style.zIndex=this.options.zindex;}if(this.options.ghosting){this._clone=this.element.cloneNode(true);this._originallyAbsolute=(this.element.getStyle("position")=="absolute");if(!this._originallyAbsolute){Position.absolutize(this.element);}this.element.parentNode.insertBefore(this._clone,this.element);}if(this.options.scroll){if(this.options.scroll==window){var _2e=this._getWindowScroll(this.options.scroll);this.originalScrollLeft=_2e.left;this.originalScrollTop=_2e.top;}else{this.originalScrollLeft=this.options.scroll.scrollLeft;this.originalScrollTop=this.options.scroll.scrollTop;}}Draggables.notify("onStart",this,_2d);if(this.options.starteffect){this.options.starteffect(this.element);}},updateDrag:function(_2f,_30){if(!this.dragging){this.startDrag(_2f);}if(!this.options.quiet){Position.prepare();Droppables.show(_30,this.element);}Draggables.notify("onDrag",this,_2f);this.draw(_30);if(this.options.change){this.options.change(this);}if(this.options.scroll){this.stopScrolling();var p;if(this.options.scroll==window){with(this._getWindowScroll(this.options.scroll)){p=[left,top,left+width,top+height];}}else{p=Position.page(this.options.scroll);p[0]+=this.options.scroll.scrollLeft+Position.deltaX;p[1]+=this.options.scroll.scrollTop+Position.deltaY;p.push(p[0]+this.options.scroll.offsetWidth);p.push(p[1]+this.options.scroll.offsetHeight);}var _31=[0,0];if(_30[0]<(p[0]+this.options.scrollSensitivity)){_31[0]=_30[0]-(p[0]+this.options.scrollSensitivity);}if(_30[1]<(p[1]+this.options.scrollSensitivity)){_31[1]=_30[1]-(p[1]+this.options.scrollSensitivity);}if(_30[0]>(p[2]-this.options.scrollSensitivity)){_31[0]=_30[0]-(p[2]-this.options.scrollSensitivity);}if(_30[1]>(p[3]-this.options.scrollSensitivity)){_31[1]=_30[1]-(p[3]-this.options.scrollSensitivity);}this.startScrolling(_31);}if(Prototype.Browser.WebKit){window.scrollBy(0,0);}Event.stop(_2f);},finishDrag:function(_32,_33){this.dragging=false;if(this.options.quiet){Position.prepare();var _34=[Event.pointerX(_32),Event.pointerY(_32)];Droppables.show(_34,this.element);}if(this.options.ghosting){if(!this._originallyAbsolute){Position.relativize(this.element);}delete this._originallyAbsolute;Element.remove(this._clone);this._clone=null;}var _35=false;if(_33){_35=Droppables.fire(_32,this.element);if(!_35){_35=false;}}if(_35&&this.options.onDropped){this.options.onDropped(this.element);}Draggables.notify("onEnd",this,_32);var _36=this.options.revert;if(_36&&Object.isFunction(_36)){_36=_36(this.element);}var d=this.currentDelta();if(_36&&this.options.reverteffect){if(_35==0||_36!="failure"){this.options.reverteffect(this.element,d[1]-this.delta[1],d[0]-this.delta[0]);}}else{this.delta=d;}if(this.options.zindex){this.element.style.zIndex=this.originalZ;}if(this.options.endeffect){this.options.endeffect(this.element);}Draggables.deactivate(this);Droppables.reset();},keyPress:function(_37){if(_37.keyCode!=Event.KEY_ESC){return;}this.finishDrag(_37,false);Event.stop(_37);},endDrag:function(_38){if(!this.dragging){return;}this.stopScrolling();this.finishDrag(_38,true);Event.stop(_38);},draw:function(_39){var pos=this.element.cumulativeOffset();if(this.options.ghosting){var r=Position.realOffset(this.element);pos[0]+=r[0]-Position.deltaX;pos[1]+=r[1]-Position.deltaY;}var d=this.currentDelta();pos[0]-=d[0];pos[1]-=d[1];if(this.options.scroll&&(this.options.scroll!=window&&this._isScrollChild)){pos[0]-=this.options.scroll.scrollLeft-this.originalScrollLeft;pos[1]-=this.options.scroll.scrollTop-this.originalScrollTop;}var p=[0,1].map(function(i){return (_39[i]-pos[i]-this.offset[i]);}.bind(this));if(this.options.snap){if(Object.isFunction(this.options.snap)){p=this.options.snap(p[0],p[1],this);}else{if(Object.isArray(this.options.snap)){p=p.map(function(v,i){return (v/this.options.snap[i]).round()*this.options.snap[i];}.bind(this));}else{p=p.map(function(v){return (v/this.options.snap).round()*this.options.snap;}.bind(this));}}}var _3a=this.element.style;if((!this.options.constraint)||(this.options.constraint=="horizontal")){_3a.left=p[0]+"px";}if((!this.options.constraint)||(this.options.constraint=="vertical")){_3a.top=p[1]+"px";}if(_3a.visibility=="hidden"){_3a.visibility="";}},stopScrolling:function(){if(this.scrollInterval){clearInterval(this.scrollInterval);this.scrollInterval=null;Draggables._lastScrollPointer=null;}},startScrolling:function(_3b){if(!(_3b[0]||_3b[1])){return;}this.scrollSpeed=[_3b[0]*this.options.scrollSpeed,_3b[1]*this.options.scrollSpeed];this.lastScrolled=new Date();this.scrollInterval=setInterval(this.scroll.bind(this),10);},scroll:function(){var _3c=new Date();var _3d=_3c-this.lastScrolled;this.lastScrolled=_3c;if(this.options.scroll==window){with(this._getWindowScroll(this.options.scroll)){if(this.scrollSpeed[0]||this.scrollSpeed[1]){var d=_3d/1000;this.options.scroll.scrollTo(left+d*this.scrollSpeed[0],top+d*this.scrollSpeed[1]);}}}else{this.options.scroll.scrollLeft+=this.scrollSpeed[0]*_3d/1000;this.options.scroll.scrollTop+=this.scrollSpeed[1]*_3d/1000;}Position.prepare();Droppables.show(Draggables._lastPointer,this.element);Draggables.notify("onDrag",this);if(this._isScrollChild){Draggables._lastScrollPointer=Draggables._lastScrollPointer||$A(Draggables._lastPointer);Draggables._lastScrollPointer[0]+=this.scrollSpeed[0]*_3d/1000;Draggables._lastScrollPointer[1]+=this.scrollSpeed[1]*_3d/1000;if(Draggables._lastScrollPointer[0]<0){Draggables._lastScrollPointer[0]=0;}if(Draggables._lastScrollPointer[1]<0){Draggables._lastScrollPointer[1]=0;}this.draw(Draggables._lastScrollPointer);}if(this.options.change){this.options.change(this);}},_getWindowScroll:function(w){var T,L,W,H;with(w.document){if(w.document.documentElement&&documentElement.scrollTop){T=documentElement.scrollTop;L=documentElement.scrollLeft;}else{if(w.document.body){T=body.scrollTop;L=body.scrollLeft;}}if(w.innerWidth){W=w.innerWidth;H=w.innerHeight;}else{if(w.document.documentElement&&documentElement.clientWidth){W=documentElement.clientWidth;H=documentElement.clientHeight;}else{W=body.offsetWidth;H=body.offsetHeight;}}}return {top:T,left:L,width:W,height:H};}});Draggable._dragging={};var SortableObserver=Class.create({initialize:function(_3e,_3f){this.element=$(_3e);this.observer=_3f;this.lastValue=Sortable.serialize(this.element);},onStart:function(){this.lastValue=Sortable.serialize(this.element);},onEnd:function(){Sortable.unmark();if(this.lastValue!=Sortable.serialize(this.element)){this.observer(this.element);}}});var Sortable={SERIALIZE_RULE:/^[^_\-](?:[A-Za-z0-9\-\_]*)[_](.*)$/,sortables:{},_findRootElement:function(_40){while(_40.tagName.toUpperCase()!="BODY"){if(_40.id&&Sortable.sortables[_40.id]){return _40;}_40=_40.parentNode;}},options:function(_41){_41=Sortable._findRootElement($(_41));if(!_41){return;}return Sortable.sortables[_41.id];},destroy:function(_42){_42=$(_42);var s=Sortable.sortables[_42.id];if(s){Draggables.removeObserver(s.element);s.droppables.each(function(d){Droppables.remove(d);});s.draggables.invoke("destroy");delete Sortable.sortables[s.element.id];}},create:function(_43){_43=$(_43);var _44=Object.extend({element:_43,tag:"li",dropOnEmpty:false,tree:false,treeTag:"ul",overlap:"vertical",constraint:"vertical",containment:_43,handle:false,only:false,delay:0,hoverclass:null,ghosting:false,quiet:false,scroll:false,scrollSensitivity:20,scrollSpeed:15,format:this.SERIALIZE_RULE,elements:false,handles:false,onChange:Prototype.emptyFunction,onUpdate:Prototype.emptyFunction},arguments[1]||{});this.destroy(_43);var _45={revert:true,quiet:_44.quiet,scroll:_44.scroll,scrollSpeed:_44.scrollSpeed,scrollSensitivity:_44.scrollSensitivity,delay:_44.delay,ghosting:_44.ghosting,constraint:_44.constraint,handle:_44.handle};if(_44.starteffect){_45.starteffect=_44.starteffect;}if(_44.reverteffect){_45.reverteffect=_44.reverteffect;}else{if(_44.ghosting){_45.reverteffect=function(_46){_46.style.top=0;_46.style.left=0;};}}if(_44.endeffect){_45.endeffect=_44.endeffect;}if(_44.zindex){_45.zindex=_44.zindex;}var _47={overlap:_44.overlap,containment:_44.containment,tree:_44.tree,hoverclass:_44.hoverclass,onHover:Sortable.onHover};var _48={onHover:Sortable.onEmptyHover,overlap:_44.overlap,containment:_44.containment,hoverclass:_44.hoverclass};Element.cleanWhitespace(_43);_44.draggables=[];_44.droppables=[];if(_44.dropOnEmpty||_44.tree){Droppables.add(_43,_48);_44.droppables.push(_43);}(_44.elements||this.findElements(_43,_44)||[]).each(function(e,i){var _49=_44.handles?$(_44.handles[i]):(_44.handle?$(e).select("."+_44.handle)[0]:e);_44.draggables.push(new Draggable(e,Object.extend(_45,{handle:_49})));Droppables.add(e,_47);if(_44.tree){e.treeNode=_43;}_44.droppables.push(e);});if(_44.tree){(Sortable.findTreeElements(_43,_44)||[]).each(function(e){Droppables.add(e,_48);e.treeNode=_43;_44.droppables.push(e);});}this.sortables[_43.identify()]=_44;Draggables.addObserver(new SortableObserver(_43,_44.onUpdate));},findElements:function(_4a,_4b){return Element.findChildren(_4a,_4b.only,_4b.tree?true:false,_4b.tag);},findTreeElements:function(_4c,_4d){return Element.findChildren(_4c,_4d.only,_4d.tree?true:false,_4d.treeTag);},onHover:function(_4e,_4f,_50){if(Element.isParent(_4f,_4e)){return;}if(_50>0.33&&_50<0.66&&Sortable.options(_4f).tree){return;}else{if(_50>0.5){Sortable.mark(_4f,"before");if(_4f.previousSibling!=_4e){var _51=_4e.parentNode;_4e.style.visibility="hidden";_4f.parentNode.insertBefore(_4e,_4f);if(_4f.parentNode!=_51){Sortable.options(_51).onChange(_4e);}Sortable.options(_4f.parentNode).onChange(_4e);}}else{Sortable.mark(_4f,"after");var _52=_4f.nextSibling||null;if(_52!=_4e){var _51=_4e.parentNode;_4e.style.visibility="hidden";_4f.parentNode.insertBefore(_4e,_52);if(_4f.parentNode!=_51){Sortable.options(_51).onChange(_4e);}Sortable.options(_4f.parentNode).onChange(_4e);}}}},onEmptyHover:function(_53,_54,_55){var _56=_53.parentNode;var _57=Sortable.options(_54);if(!Element.isParent(_54,_53)){var _58;var _59=Sortable.findElements(_54,{tag:_57.tag,only:_57.only});var _5a=null;if(_59){var _5b=Element.offsetSize(_54,_57.overlap)*(1-_55);for(_58=0;_58<_59.length;_58+=1){if(_5b-Element.offsetSize(_59[_58],_57.overlap)>=0){_5b-=Element.offsetSize(_59[_58],_57.overlap);}else{if(_5b-(Element.offsetSize(_59[_58],_57.overlap)/2)>=0){_5a=_58+1<_59.length?_59[_58+1]:null;break;}else{_5a=_59[_58];break;}}}}_54.insertBefore(_53,_5a);Sortable.options(_56).onChange(_53);_57.onChange(_53);}},unmark:function(){if(Sortable._marker){Sortable._marker.hide();}},mark:function(_5c,_5d){var _5e=Sortable.options(_5c.parentNode);if(_5e&&!_5e.ghosting){return;}if(!Sortable._marker){Sortable._marker=($("dropmarker")||Element.extend(document.createElement("DIV"))).hide().addClassName("dropmarker").setStyle({position:"absolute"});document.getElementsByTagName("body").item(0).appendChild(Sortable._marker);}var _5f=_5c.cumulativeOffset();Sortable._marker.setStyle({left:_5f[0]+"px",top:_5f[1]+"px"});if(_5d=="after"){if(_5e.overlap=="horizontal"){Sortable._marker.setStyle({left:(_5f[0]+_5c.clientWidth)+"px"});}else{Sortable._marker.setStyle({top:(_5f[1]+_5c.clientHeight)+"px"});}}Sortable._marker.show();},_tree:function(_60,_61,_62){var _63=Sortable.findElements(_60,_61)||[];for(var i=0;i<_63.length;++i){var _64=_63[i].id.match(_61.format);if(!_64){continue;}var _65={id:encodeURIComponent(_64?_64[1]:null),element:_60,parent:_62,children:[],position:_62.children.length,container:$(_63[i]).down(_61.treeTag)};if(_65.container){this._tree(_65.container,_61,_65);}_62.children.push(_65);}return _62;},tree:function(_66){_66=$(_66);var _67=this.options(_66);var _68=Object.extend({tag:_67.tag,treeTag:_67.treeTag,only:_67.only,name:_66.id,format:_67.format},arguments[1]||{});var _69={id:null,parent:null,children:[],container:_66,position:0};return Sortable._tree(_66,_68,_69);},_constructIndex:function(_6a){var _6b="";do{if(_6a.id){_6b="["+_6a.position+"]"+_6b;}}while((_6a=_6a.parent)!=null);return _6b;},sequence:function(_6c){_6c=$(_6c);var _6d=Object.extend(this.options(_6c),arguments[1]||{});return $(this.findElements(_6c,_6d)||[]).map(function(_6e){return _6e.id.match(_6d.format)?_6e.id.match(_6d.format)[1]:"";});},setSequence:function(_6f,_70){_6f=$(_6f);var _71=Object.extend(this.options(_6f),arguments[2]||{});var _72={};this.findElements(_6f,_71).each(function(n){if(n.id.match(_71.format)){_72[n.id.match(_71.format)[1]]=[n,n.parentNode];}n.parentNode.removeChild(n);});_70.each(function(_73){var n=_72[_73];if(n){n[1].appendChild(n[0]);delete _72[_73];}});},serialize:function(_74){_74=$(_74);var _75=Object.extend(Sortable.options(_74),arguments[1]||{});var _76=encodeURIComponent((arguments[1]&&arguments[1].name)?arguments[1].name:_74.id);if(_75.tree){return Sortable.tree(_74,arguments[1]).children.map(function(_77){return [_76+Sortable._constructIndex(_77)+"[id]="+encodeURIComponent(_77.id)].concat(_77.children.map(arguments.callee));}).flatten().join("&");}else{return Sortable.sequence(_74,arguments[1]).map(function(_78){return _76+"[]="+encodeURIComponent(_78);}).join("&");}}};Element.isParent=function(_79,_7a){if(!_79.parentNode||_79==_7a){return false;}if(_79.parentNode==_7a){return true;}return Element.isParent(_79.parentNode,_7a);};Element.findChildren=function(_7b,_7c,_7d,_7e){if(!_7b.hasChildNodes()){return null;}_7e=_7e.toUpperCase();if(_7c){_7c=[_7c].flatten();}var _7f=[];$A(_7b.childNodes).each(function(e){if(e.tagName&&e.tagName.toUpperCase()==_7e&&(!_7c||(Element.classNames(e).detect(function(v){return _7c.include(v);})))){_7f.push(e);}if(_7d){var _80=Element.findChildren(e,_7c,_7d,_7e);if(_80){_7f.push(_80);}}});return (_7f.length>0?_7f.flatten():[]);};Element.offsetSize=function(_81,_82){return _81["offset"+((_82=="vertical"||_82=="height")?"Height":"Width")];};