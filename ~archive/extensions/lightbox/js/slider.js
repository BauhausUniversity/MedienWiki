if(!Control){var Control={};}Control.Slider=Class.create({initialize:function(_1,_2,_3){var _4=this;if(Object.isArray(_1)){this.handles=_1.collect(function(e){return $(e);});}else{this.handles=[$(_1)];}this.track=$(_2);this.options=_3||{};this.axis=this.options.axis||"horizontal";this.increment=this.options.increment||1;this.step=parseInt(this.options.step||"1");this.range=this.options.range||$R(0,1);this.value=0;this.values=this.handles.map(function(){return 0;});this.spans=this.options.spans?this.options.spans.map(function(s){return $(s);}):false;this.options.startSpan=$(this.options.startSpan||null);this.options.endSpan=$(this.options.endSpan||null);this.restricted=this.options.restricted||false;this.maximum=this.options.maximum||this.range.end;this.minimum=this.options.minimum||this.range.start;this.alignX=parseInt(this.options.alignX||"0");this.alignY=parseInt(this.options.alignY||"0");this.trackLength=this.maximumOffset()-this.minimumOffset();this.handleLength=this.isVertical()?(this.handles[0].offsetHeight!=0?this.handles[0].offsetHeight:this.handles[0].style.height.replace(/px$/,"")):(this.handles[0].offsetWidth!=0?this.handles[0].offsetWidth:this.handles[0].style.width.replace(/px$/,""));this.active=false;this.dragging=false;this.disabled=false;if(this.options.disabled){this.setDisabled();}this.allowedValues=this.options.values?this.options.values.sortBy(Prototype.K):false;if(this.allowedValues){this.minimum=this.allowedValues.min();this.maximum=this.allowedValues.max();}this.eventMouseDown=this.startDrag.bindAsEventListener(this);this.eventMouseUp=this.endDrag.bindAsEventListener(this);this.eventMouseMove=this.update.bindAsEventListener(this);this.handles.each(function(h,i){i=_4.handles.length-1-i;_4.setValue(parseFloat((Object.isArray(_4.options.sliderValue)?_4.options.sliderValue[i]:_4.options.sliderValue)||_4.range.start),i);h.makePositioned().observe("mousedown",_4.eventMouseDown);});this.track.observe("mousedown",this.eventMouseDown);document.observe("mouseup",this.eventMouseUp);document.observe("mousemove",this.eventMouseMove);this.initialized=true;},dispose:function(){var _5=this;Event.stopObserving(this.track,"mousedown",this.eventMouseDown);Event.stopObserving(document,"mouseup",this.eventMouseUp);Event.stopObserving(document,"mousemove",this.eventMouseMove);this.handles.each(function(h){Event.stopObserving(h,"mousedown",_5.eventMouseDown);});},setDisabled:function(){this.disabled=true;},setEnabled:function(){this.disabled=false;},getNearestValue:function(_6){if(this.allowedValues){if(_6>=this.allowedValues.max()){return (this.allowedValues.max());}if(_6<=this.allowedValues.min()){return (this.allowedValues.min());}var _7=Math.abs(this.allowedValues[0]-_6);var _8=this.allowedValues[0];this.allowedValues.each(function(v){var _9=Math.abs(v-_6);if(_9<=_7){_8=v;_7=_9;}});return _8;}if(_6>this.range.end){return this.range.end;}if(_6<this.range.start){return this.range.start;}return _6;},setValue:function(_a,_b){if(!this.active){this.activeHandleIdx=_b||0;this.activeHandle=this.handles[this.activeHandleIdx];this.updateStyles();}_b=_b||this.activeHandleIdx||0;if(this.initialized&&this.restricted){if((_b>0)&&(_a<this.values[_b-1])){_a=this.values[_b-1];}if((_b<(this.handles.length-1))&&(_a>this.values[_b+1])){_a=this.values[_b+1];}}_a=this.getNearestValue(_a);this.values[_b]=_a;this.value=this.values[0];this.handles[_b].style[this.isVertical()?"top":"left"]=this.translateToPx(_a);this.drawSpans();if(!this.dragging||!this.event){this.updateFinished();}},setValueBy:function(_c,_d){this.setValue(this.values[_d||this.activeHandleIdx||0]+_c,_d||this.activeHandleIdx||0);},translateToPx:function(_e){return Math.round(((this.trackLength-this.handleLength)/(this.range.end-this.range.start))*(_e-this.range.start))+"px";},translateToValue:function(_f){return ((_f/(this.trackLength-this.handleLength)*(this.range.end-this.range.start))+this.range.start);},getRange:function(_10){var v=this.values.sortBy(Prototype.K);_10=_10||0;return $R(v[_10],v[_10+1]);},minimumOffset:function(){return (this.isVertical()?this.alignY:this.alignX);},maximumOffset:function(){return (this.isVertical()?(this.track.offsetHeight!=0?this.track.offsetHeight:this.track.style.height.replace(/px$/,""))-this.alignY:(this.track.offsetWidth!=0?this.track.offsetWidth:this.track.style.width.replace(/px$/,""))-this.alignX);},isVertical:function(){return (this.axis=="vertical");},drawSpans:function(){var _11=this;if(this.spans){$R(0,this.spans.length-1).each(function(r){_11.setSpan(_11.spans[r],_11.getRange(r));});}if(this.options.startSpan){this.setSpan(this.options.startSpan,$R(0,this.values.length>1?this.getRange(0).min():this.value));}if(this.options.endSpan){this.setSpan(this.options.endSpan,$R(this.values.length>1?this.getRange(this.spans.length-1).max():this.value,this.maximum));}},setSpan:function(_12,_13){if(this.isVertical()){_12.style.top=this.translateToPx(_13.start);_12.style.height=this.translateToPx(_13.end-_13.start+this.range.start);}else{_12.style.left=this.translateToPx(_13.start);_12.style.width=this.translateToPx(_13.end-_13.start+this.range.start);}},updateStyles:function(){this.handles.each(function(h){Element.removeClassName(h,"selected");});Element.addClassName(this.activeHandle,"selected");},startDrag:function(_14){if(Event.isLeftClick(_14)){if(!this.disabled){this.active=true;var _15=Event.element(_14);var _16=[Event.pointerX(_14),Event.pointerY(_14)];var _17=_15;if(_17==this.track){var _18=this.track.cumulativeOffset();this.event=_14;this.setValue(this.translateToValue((this.isVertical()?_16[1]-_18[1]:_16[0]-_18[0])-(this.handleLength/2)));var _18=this.activeHandle.cumulativeOffset();this.offsetX=(_16[0]-_18[0]);this.offsetY=(_16[1]-_18[1]);}else{while((this.handles.indexOf(_15)==-1)&&_15.parentNode){_15=_15.parentNode;}if(this.handles.indexOf(_15)!=-1){this.activeHandle=_15;this.activeHandleIdx=this.handles.indexOf(this.activeHandle);this.updateStyles();var _18=this.activeHandle.cumulativeOffset();this.offsetX=(_16[0]-_18[0]);this.offsetY=(_16[1]-_18[1]);}}}Event.stop(_14);}},update:function(_19){if(this.active){if(!this.dragging){this.dragging=true;}this.draw(_19);if(Prototype.Browser.WebKit){window.scrollBy(0,0);}Event.stop(_19);}},draw:function(_1a){var _1b=[Event.pointerX(_1a),Event.pointerY(_1a)];var _1c=this.track.cumulativeOffset();_1b[0]-=this.offsetX+_1c[0];_1b[1]-=this.offsetY+_1c[1];this.event=_1a;this.setValue(this.translateToValue(this.isVertical()?_1b[1]:_1b[0]));if(this.initialized&&this.options.onSlide){this.options.onSlide(this.values.length>1?this.values:this.value,this);}},endDrag:function(_1d){if(this.active&&this.dragging){this.finishDrag(_1d,true);Event.stop(_1d);}this.active=false;this.dragging=false;},finishDrag:function(_1e,_1f){this.active=false;this.dragging=false;this.updateFinished();},updateFinished:function(){if(this.initialized&&this.options.onChange){this.options.onChange(this.values.length>1?this.values:this.value,this);}this.event=null;}});